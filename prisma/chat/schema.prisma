generator client {
  provider = "prisma-client-js"
  output   = "../../node_modules/@prisma/prisma-chat-client"
}

datasource db {
  provider = "mongodb"
  url      = env("CHAT_DB_URL")
}

model Room {
  id         String    @id @default(auto()) @map("_id") @db.ObjectId
  name       String?
  members    String[]
  private    Boolean   @default(true)
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  lastActive DateTime?
  messages   Message[]

  @@index([members])
}

model Message {
  id          String      @id @default(auto()) @map("_id") @db.ObjectId
  roomId      String      @db.ObjectId
  senderId    String
  content     String
  messageType MessageType
  attachment  String?
  readBy      String[]
  deleted     Boolean     @default(false)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  room        Room        @relation(fields: [roomId], references: [id], onDelete: Cascade)
  replies     Message[]   @relation("RepliesTo")
  parentId    String?     @db.ObjectId
  replyTo     Message?    @relation("RepliesTo", fields: [parentId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([roomId, createdAt])
}

enum MessageType {
  TEXT
  IMAGE
  VIDEO
  AUDIO
  FILE
}
